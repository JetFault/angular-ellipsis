angular.module("dibari.angular-ellipsis",[]).directive("ellipsis",["$timeout","$window",function(a,b){return{restrict:"A",scope:{ngBind:"=",ellipsisAppend:"@",ellipsisAppendClick:"&",ellipsisSymbol:"@",alwaysShowAppend:"@"},compile:function(){return function(c,d,e){function f(){var a=angular.element("<div>").html(c.ngBind).text().trim();if(c.ngBind){var b=a.split(" "),f=0,i="undefined"!=typeof e.ellipsisSymbol?e.ellipsisSymbol:"&hellip;",j="undefined"!=typeof c.ellipsisAppend&&""!==c.ellipsisAppend?i+"<span>"+c.ellipsisAppend+"</span>":i;if(e.isTruncated=!1,d.text(a),h&&d.html(d.html()+j),g(d)){var k=b.length,l=d[0].clientHeight;for(d.text(a).html(d.html()+j);k>f;f++)if(b.pop(),d.text(b.join(" ")).html(d.html()+j),d[0].scrollHeight<l||g(d)===!1){e.isTruncated=!0;break}i!=j&&"undefined"!=typeof c.ellipsisAppendClick&&""!==c.ellipsisAppendClick&&d.find("span").bind("click",function(){c.$apply(c.ellipsisAppendClick)})}}}function g(a){return a[0].scrollHeight>a[0].clientHeight}e.lastWindowResizeTime=0,e.lastWindowResizeWidth=0,e.lastWindowResizeHeight=0,e.lastWindowTimeoutEvent=null,e.isTruncated=!1;var h=c.$eval(c.alwaysShowAppend);c.$watch("ngBind",function(){a(function(){f()})}),c.$watch("ellipsisAppend",function(){f()}),angular.element(b).bind("resize",function(){a.cancel(e.lastWindowTimeoutEvent),e.lastWindowTimeoutEvent=a(function(){(e.lastWindowResizeWidth!=window.innerWidth||e.lastWindowResizeHeight!=window.innerHeight)&&f(),e.lastWindowResizeWidth=window.innerWidth,e.lastWindowResizeHeight=window.innerHeight},75)})}}}}]);